version 1.0

#######################
## This is the workflow
#######################

workflow filter_vcf {
  input {
    File vcf_input
    File vcf_output
    Int disk_size_gb
    Int? machine_mem_mb
    String docker
  }

  call filter_vcf_task {
    input:
      vcf_input = vcf_input,
      vcf_output = vcf_output,
      disk_size_gb = disk_size_gb,
      machine_mem_mb = machine_mem_mb,
      docker = docker
  }
}

#######################
## Tasks
#######################

task filter_vcf_task {
  input {
    File vcf_input
    File vcf_output
  }

  command { # Need the <<< >>> ?
    bcftools view -i '
      AF[0] > 0.05 && 
      INFO/SVTYPE="DEL" && 
      FILTER="PASS" && 
      (INFO/EVIDENCE ~ "RD" && (INFO/EVIDENCE ~ "SR" || INFO/EVIDENCE ~ "PE"))
    ' ${vcf_input} -o ${vcf_output}
  }

  output { # Should this be in task or workflow?
    File filtered_vcf = vcf_output
  }

  runtime { # Is this the approporiate amount?
    memory: "~{machine_mem_mb} MiB"
    cpu: "1"
    bootDiskSizeGb: 15
    disks: "local-disk " + disk_size_gb + " HDD"
    preemptible: 1
    docker: "bcftools/bcftools"
  }
}